"use strict";var express=require("express"),session=require("express-session"),passport=require("passport"),LocalStrategy=require("passport-local").Strategy,cookieParser=require("cookie-parser"),router=express.Router(),bodyParser=require("body-parser"),path=require("path"),ejs=require("ejs");require("dotenv").config();var mongoose=require("mongoose"),mongoURL="mongodb://"+process.env.DB_USER+":"+process.env.DB_PASS+"@"+process.env.DB_HOST+":19014/"+process.env.DB_DATABASENAME,MongoStore=require("connect-mongo")(session),connect_db=mongoose.connect(mongoURL).then(function(){console.log("CONNECTED SUCCESFULLY TO THE DATABASE");var e=express(),s=process.env.PORT||8e3;e.use(express.static(path.join(__dirname,"public")));var r=require("./models/user");passport.use(new LocalStrategy(function(e,s,o){r.findOne({username:e},function(e,r){return e?o(e):r?r.validPassword(s)?o(null,r):o(null,!1,{message:"Incorrect password."}):o(null,!1,{message:"Incorrect username."})})})),passport.serializeUser(function(e,s){s(null,e.id)}),passport.deserializeUser(function(e,s){r.findById(e,function(e,r){s(e,r)})}),e.use(cookieParser()),e.use(session({resave:!0,saveUninitialized:!0,secret:process.env.DB_SECRET,store:new MongoStore({url:mongoURL,autoReconnect:!0,collection:"sessions"})})),e.use(passport.initialize()),e.use(passport.session()),e.set("view engine","ejs"),e.use(bodyParser.urlencoded({extended:!0})),e.use(bodyParser.json());var o=require("./routes/home"),n=require("./routes/options"),t=require("./routes/contact");e.use(o),e.use(n),e.use(t),e.listen(s,function(){console.log("Server listening on port "+s)})}).catch(function(e){console.error("Error during connect to the DATABASE: "+e)});