"use strict";function loggedIn(e,t,o){e.user?o():t.redirect("/login")}var router=require("express").Router(),bcrypt=require("bcryptjs"),passport=require("passport"),Profile=require("../models/profile"),Services=require("../models/services"),Benefit=require("../models/benefit"),Contact=require("../models/contact"),User=require("../models/user"),ContactData=require("../models/contact_data"),servicesData=[],benefitsData=[];router.get("/login",function(e,t){e.user?t.redirect("/options"):t.render("login")}),router.post("/login",passport.authenticate("local",{successRedirect:"/options",failureRedirect:"/login",failureFlash:!1})),router.get("/options",loggedIn,function(e,t){var o={},i=0,n=0;Profile.findById("59abc4c29f6c941060343599",function(e,t){if(e)throw new Error(e)}).then(function(e){o=e}).then(function(e){Services.find({},function(e,t){if(e)throw new Error(e)}).then(function(e){servicesData=e}).then(function(e){Benefit.find({},function(e,t){if(e)throw new Error(e)}).then(function(e){benefitsData=e}).then(function(e){Contact.find({},function(e,t){if(e)throw new Error(e)}).then(function(e){i=e.length;for(var t=0;t<i;t++)e[t].unreaded&&n++}).then(function(e){ContactData.findById("59aeee169b9dcf1ac06b4e3f",function(e,t){if(e)throw new Error(e)}).then(function(e){t.render("options",{valueTitle:o.title,valueUrl:o.imageURL,valueDescription:o.description,services:servicesData,benefits:benefitsData,newMessages:n,contactData:e})})})})})})}),router.post("/options/edit/profile",function(e,t){var o={};e.body.title&&(o.title=e.body.title.toUpperCase()),e.body.imageUrl&&(o.imageURL=e.body.imageUrl),e.body.description&&(o.description=e.body.description),Profile.findByIdAndUpdate("59abc4c29f6c941060343599",{$set:o},{new:!0},function(e,o){if(e)throw new Error(e);console.log("DOCUMENT UPDATED WITH SUCCESS: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),router.post("/options/:index",function(e,t){var o={};e.body.serviceTitle&&(o.nameService=e.body.serviceTitle),e.body.serviceDescription&&(o.description=e.body.serviceDescription),Services.findOneAndUpdate({nameService:servicesData[e.params.index].nameService},{$set:o},{new:!0},function(e,o){if(e)throw new Error(e);console.log("DOCUMENT UPDATED WITH SUCCESS: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),router.post("/options/delete/:index",function(e,t){Services.findOneAndRemove({nameService:servicesData[e.params.index].nameService},function(e,o){if(e)throw new Error(e);console.log("DOCUMENT DELETED WITH SUCCESS: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),router.post("/options/add/new",function(e,t){(new Services).save(function(e,o){if(e)throw new Error(e);console.log("NEW SERVICE ADDED: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),router.post("/options/addbenefit/new",function(e,t){(new Benefit).save(function(e,o){if(e)throw new Error(e);console.log("NEW BENEFIT ADDED: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),router.post("/options/benefit/:index",function(e,t){var o={};e.body.benefitTitle&&(o.title=e.body.benefitTitle),e.body.benefitURL&&(o.imageURL=e.body.benefitURL),Benefit.findOneAndUpdate({title:benefitsData[e.params.index].title},{$set:o},{new:!0},function(e,o){if(e)throw new Error(e);console.log("DOCUMENT UPDATED WITH SUCCESS: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),router.post("/options/remove/:index",function(e,t){Benefit.findOneAndRemove({title:benefitsData[e.params.index].title},function(e,o){if(e)throw new Error(e);console.log("DOCUMENT DELETED WITH SUCCESS: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),router.post("/options/contact_info/update",function(e,t){var o={};e.body.contact_email&&(o.email=e.body.contact_email),e.body.contact_phone&&(o.phone=e.body.contact_phone),ContactData.findByIdAndUpdate("59aeee169b9dcf1ac06b4e3f",{$set:o},{new:!0},function(e,o){if(e)throw new Error(e);console.log("DOCUMENT UPDATED WITH SUCCESS: "+JSON.stringify(o,void 0,2)),t.redirect("/options")})}),module.exports=router;